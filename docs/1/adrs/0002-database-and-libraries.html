<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ADR 0002: Use Postgres and jOOQ :: Expense Tracker Docs</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
    <nav class="navbar">
        <div class="navbar-brand">
            <a class="navbar-item" href="../../..">Expense Tracker Docs</a>
                <div class="navbar-item search hide-for-print">
                    <div id="search-field" class="field">
                        <input id="search-input" type="text" placeholder="Search the docs">
                    </div>
                </div>
            <button class="navbar-burger" data-target="topbar-nav">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
        <div id="topbar-nav" class="navbar-menu">
            <!--<div class="navbar-end">
              <a class="navbar-item" href="#">Home</a>
              <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link" href="#">Products</a>
                <div class="navbar-dropdown">
                  <a class="navbar-item" href="#">Product A</a>
                  <a class="navbar-item" href="#">Product B</a>
                  <a class="navbar-item" href="#">Product C</a>
                </div>
              </div>
              <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link" href="#">Services</a>
                <div class="navbar-dropdown">
                  <a class="navbar-item" href="#">Service A</a>
                  <a class="navbar-item" href="#">Service B</a>
                  <a class="navbar-item" href="#">Service C</a>
                </div>
              </div>
              <div class="navbar-item">
                <span class="control">
                  <a class="button is-primary" href="#">Download</a>
                </span>
              </div>
            </div>-->
        </div>
    </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Docs</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../mvp.html">MVP for expense-tracker</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../tools.html">Tools for expense-tracker</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../commit-message-format.html">Commit message format</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Architecture Decision Records</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="0001-gradle-multi-project.html">ADR 0001: Create single multi-project Gradle build</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="0002-database-and-libraries.html">ADR 0002: Use Postgres and jOOQ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="0003-oauth.html">ADR 0003: Use Keycloak for Identity and Access Management (IAM)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="0004-kubernetes.html">ADR 0004: Deployment Infrastructure as code (IaC)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../diagram.html">A test diagram</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Unlisted Pages</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Docs</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Docs</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Docs</a></li>
    <li>Architecture Decision Records</li>
    <li><a href="0002-database-and-libraries.html">ADR 0002: Use Postgres and jOOQ</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="https://github.com/KTRI-Industries/expense-tracker-docs/edit/main/docs/modules/ROOT/pages/adrs/0002-database-and-libraries.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">ADR 0002: Use Postgres and jOOQ</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Date: 2023-07-03</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_status"><a class="anchor" href="#_status"></a>Status</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Accepted</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_context"><a class="anchor" href="#_context"></a>Context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When it comes to relational databases, the de facto choices are MySQL and PostgreSQL.</p>
</div>
<div class="paragraph">
<p>PostgreSQl is very similar to MySQL, but it is supposed to be a more advanced version, with more features.
Also, because it uses Multi-version concurrency control (MVCC) it is supposed to outperform MySQL in write-intensive applications.</p>
</div>
<div class="paragraph">
<p>When accessing database from JVM applications, Hibernate is the ORM of choice.
But it is not easy to create complex dynamic queries with Hibernate.
Also, you need to be very careful when querying entities with nested relationships because the generated query is not always obvious.</p>
</div>
<div class="paragraph">
<p>jOOQ can be a replacement for Hibernate, but also it can be used together with Hibernate.
In that case, all non-trivial queries can be written in jOOQ but still use Hibernate for entity lifecycle operations (e.g. retrieve an entity, update and store it).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_decision"><a class="anchor" href="#_decision"></a>Decision</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will use a dockerized PostgreSQL instance for local development.</p>
</div>
<div class="paragraph">
<p>We will start with Hibernate and introduce jOOQ when initial database schema is created (jOOQ needs existing database for auto-generated classes).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_consequences"><a class="anchor" href="#_consequences"></a>Consequences</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using PostgreSQL does not mean we need to use all the advanced features that are provided and that MySQL does not offer.
It means that when we need such a feature it will be there for us to use it.
One feature that we might end up using is row level security, to be used for multi-tenancy (see for example <a href="https://betterprogramming.pub/multi-tenancy-support-with-spring-boot-liquibase-and-postgresql-d41942dc0639">here</a>)</p>
</div>
<div class="paragraph">
<p>Using jOOQ will result in a slight learning curve, but we can use it only when complex queries are needed, or maybe when native PostgreSQL features can be used, or advanced SQL syntax which are things not available in Hibernate.</p>
</div>
<div class="paragraph">
<p>Finally, there is a killer feature, in case of complex queries, which is the <a href="https://vladmihalcea.com/fetch-multiple-to-many-jooq-multiset/">multiset</a>.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
